# ğŸ“Š Mundi.ai å®Œæ•´ç³»ç»Ÿæ¶æ„ä¸åŠŸèƒ½æ¦‚è¿°

## ä¸€ã€ç³»ç»Ÿæ ¸å¿ƒå®šä½

### 1.1 äº§å“å®šä¹‰
**Mundi.ai** æ˜¯ä¸€ä¸ª**AIåŸç”Ÿçš„åœ°ç†ç©ºé—´æ™ºèƒ½å¹³å°**ï¼Œå°†å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä¸GISæŠ€æœ¯æ·±åº¦èåˆï¼Œè®©ç”¨æˆ·é€šè¿‡è‡ªç„¶è¯­è¨€å¯¹è¯å³å¯å®Œæˆå¤æ‚çš„ç©ºé—´æ•°æ®åˆ†æã€åœ°å›¾åˆ¶ä½œå’ŒçŸ¥è¯†å›¾è°±æ„å»ºã€‚

**æ ¸å¿ƒä»·å€¼ä¸»å¼ **ï¼š
- âŒ ä¼ ç»ŸGISï¼šéœ€è¦å­¦ä¹ ä¸“ä¸šè½¯ä»¶ã€æŒæ¡ç©ºé—´åˆ†æè¯­æ³•
- âœ… Mundi.aiï¼šåƒèŠå¤©ä¸€æ ·å®Œæˆæ‰€æœ‰GISæ“ä½œ

### 1.2 æŠ€æœ¯å·®å¼‚åŒ–ä¼˜åŠ¿

| ç»´åº¦ | ä¼ ç»ŸGISå¹³å° | Mundi.ai |
|------|------------|----------|
| **äº¤äº’æ–¹å¼** | å›¾å½¢ç•Œé¢ç‚¹å‡»ã€ä¸“ä¸šå·¥å…·æ  | è‡ªç„¶è¯­è¨€å¯¹è¯ |
| **åˆ†æèƒ½åŠ›** | ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©ç®—æ³• | AIè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜å·¥å…· |
| **çŸ¥è¯†è¡¨è¾¾** | ç›®å½•æ ‘ã€å›¾å±‚åˆ—è¡¨ | çŸ¥è¯†å›¾è°±ã€è¯­ä¹‰å…³ç³» |
| **æ•°æ®èåˆ** | æ‰‹åŠ¨å¯¼å…¥ã€æ ¼å¼è½¬æ¢ | è‡ªåŠ¨è¿æ¥å™¨ã€å®æ—¶åŒæ­¥ |
| **æ´å¯Ÿç”Ÿæˆ** | é™æ€åœ°å›¾ã€å›¾è¡¨ | AIç”Ÿæˆåˆ†ææ‘˜è¦ã€é¢„æµ‹ |

### 1.3 ç›®æ ‡ç”¨æˆ·åœºæ™¯

1. **æ°´ç”µä¸“ä¸šç›‘æµ‹**ï¼šæ°´åˆ©å·¥ç¨‹ã€ç”µåŠ›è°ƒåº¦ã€ç¾å®³é¢„è­¦
2. **ç©ºé—´è§„åˆ’**ï¼šåŸå¸‚è§„åˆ’ã€åœŸåœ°åˆ©ç”¨ã€äº¤é€šå¸ƒå±€
3. **ç¯å¢ƒç›‘æµ‹**ï¼šæ°´è´¨åˆ†æã€ç”Ÿæ€è¯„ä¼°ã€æ±¡æŸ“æº¯æº
4. **åº”æ€¥ç®¡ç†**ï¼šæ´ªæ°´æ¨¡æ‹Ÿã€ç–æ•£è·¯çº¿ã€èµ„æºè°ƒé…

---

## äºŒã€å®Œæ•´æŠ€æœ¯æ¶æ„

### 2.1 ç³»ç»Ÿæ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·å±‚ (User Layer)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Webæµè§ˆå™¨ / ç§»åŠ¨ç«¯ / æ¡Œé¢å®¢æˆ·ç«¯                                     â”‚
â”‚  React + TypeScript + MapLibre GL JS                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     APIç½‘å…³å±‚ (API Gateway)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FastAPIåº”ç”¨æœåŠ¡å™¨ (src/wsgi.py)                                    â”‚
â”‚  â”œâ”€â”€ HTTP/REST API                                                  â”‚
â”‚  â”œâ”€â”€ WebSocketå®æ—¶é€šä¿¡                                               â”‚
â”‚  â””â”€â”€ GraphQL (é¢„ç•™)                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     ä¸šåŠ¡æœåŠ¡å±‚ (Service Layer)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Œ è·¯ç”±æ¨¡å— (Routes)                                               â”‚
â”‚  â”œâ”€â”€ postgres_routes.py      - PostGISç©ºé—´æ•°æ®æ“ä½œ                  â”‚
â”‚  â”œâ”€â”€ message_routes.py       - AIèŠå¤©ä¸å·¥å…·è°ƒç”¨                     â”‚
â”‚  â”œâ”€â”€ hydropower_routes.py    - æ°´ç”µä¸“ä¸šåŠŸèƒ½                         â”‚
â”‚  â”œâ”€â”€ graph_routes.py         - çŸ¥è¯†å›¾è°±æŸ¥è¯¢                         â”‚
â”‚  â”œâ”€â”€ orchestrator_routes.py  - æ ¸å¿ƒæ¶æ„å±‚                           â”‚
â”‚  â””â”€â”€ websocket.py            - å®æ—¶åä½œé€šä¿¡                         â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“Œ æœåŠ¡æ¨¡å— (Services)                                             â”‚
â”‚  â”œâ”€â”€ graph_service.py        - Neo4jå›¾æ•°æ®åº“æ“ä½œ                   â”‚
â”‚  â”œâ”€â”€ intent_engine.py        - AIæ„å›¾è¯†åˆ« (O(1)ç´¢å¼•)               â”‚
â”‚  â””â”€â”€ kg_integration.py       - çŸ¥è¯†å›¾è°±é›†æˆ                       â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“Œ è¿æ¥å™¨ (Connectors)                                             â”‚
â”‚  â”œâ”€â”€ usgs_connector.py       - USGSæ°´æ–‡æ•°æ®                        â”‚
â”‚  â”œâ”€â”€ mwr_connector.py        - ä¸­å›½æ°´åˆ©éƒ¨æ•°æ®                      â”‚
â”‚  â””â”€â”€ base_connector.py       - è¿æ¥å™¨åŸºç±»                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      æ•°æ®å­˜å‚¨å±‚ (Data Layer)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ—„ï¸  PostgreSQL + PostGIS (ç©ºé—´æ•°æ®åº“)                              â”‚
â”‚  â”œâ”€â”€ é¡¹ç›®/åœ°å›¾/å›¾å±‚å…ƒæ•°æ®                                          â”‚
â”‚  â”œâ”€â”€ ç”¨æˆ·ä¼šè¯å’Œå¯¹è¯å†å²                                            â”‚
â”‚  â”œâ”€â”€ æ•°æ®åº“è¿æ¥é…ç½®                                                â”‚
â”‚  â””â”€â”€ ç©ºé—´ç´¢å¼• (GIST/BRIN)                                         â”‚
â”‚                                                                     â”‚
â”‚  ğŸ§  Neo4j (çŸ¥è¯†å›¾è°±æ•°æ®åº“)                                          â”‚
â”‚  â”œâ”€â”€ LocationèŠ‚ç‚¹ (åæ ‡ã€è¾¹ç•Œæ¡†)                                  â”‚
â”‚  â”œâ”€â”€ AdministrativeUnitèŠ‚ç‚¹ (è¡Œæ”¿åŒºåˆ’)                            â”‚
â”‚  â”œâ”€â”€ FeatureèŠ‚ç‚¹ (GISè¦ç´ )                                        â”‚
â”‚  â”œâ”€â”€ DatasetèŠ‚ç‚¹ (æ•°æ®é›†å…ƒæ•°æ®)                                   â”‚
â”‚  â”œâ”€â”€ ç©ºé—´å…³ç³»è¾¹ (CONTAINS, ADJACENT_TO)                           â”‚
â”‚  â””â”€â”€ æ—¶åºå…³ç³»è¾¹ (OCCURS_DURING, BEFORE/AFTER)                     â”‚
â”‚                                                                     â”‚
â”‚  ğŸ’¾ MinIO (å¯¹è±¡å­˜å‚¨)                                                â”‚
â”‚  â”œâ”€â”€ ä¸Šä¼ çš„çŸ¢é‡/æ …æ ¼æ•°æ®                                           â”‚
â”‚  â”œâ”€â”€ ç”Ÿæˆçš„åœ°å›¾å›¾ç‰‡                                                â”‚
â”‚  â””â”€â”€ ä¸´æ—¶å¤„ç†æ–‡ä»¶                                                  â”‚
â”‚                                                                     â”‚
â”‚  âš¡ Redis (ç¼“å­˜ä¸æ¶ˆæ¯é˜Ÿåˆ—)                                          â”‚
â”‚  â”œâ”€â”€ ç”¨æˆ·ä¼šè¯ä¼šè¯ç®¡ç†                                              â”‚
â”‚  â”œâ”€â”€ USGSæ•°æ®ç¼“å­˜ (5åˆ†é’ŸTTL)                                      â”‚
â”‚  â””â”€â”€ WebSocketæ¶ˆæ¯å¹¿æ’­                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    å®‰å…¨ä¸ç›‘æ§å±‚ (Security Layer)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”’ å®‰å…¨æ¨¡å— (Security)                                             â”‚
â”‚  â”œâ”€â”€ sql_validator.py        - SQLæ³¨å…¥æ£€æµ‹ä¸é˜²æŠ¤                  â”‚
â”‚  â”œâ”€â”€ file_upload_validator.py - æ–‡ä»¶ä¸Šä¼ å¤šå±‚éªŒè¯                   â”‚
â”‚  â”œâ”€â”€ auth_system.py          - JWTè®¤è¯ä¸RBACæƒé™æ§åˆ¶              â”‚
â”‚  â””â”€â”€ error_middleware.py     - é”™è¯¯å¤„ç†ä¸ä¿¡æ¯è„±æ•                 â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“Š ç›‘æ§ä¸å¯è§‚æµ‹æ€§                                                 â”‚
â”‚  â”œâ”€â”€ OpenTelemetry           - åˆ†å¸ƒå¼è¿½è¸ª                         â”‚
â”‚  â”œâ”€â”€ Prometheus              - æ€§èƒ½æŒ‡æ ‡æ”¶é›†                       â”‚
â”‚  â””â”€â”€ Grafana                 - å¯è§†åŒ–ä»ªè¡¨ç›˜                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   å¤–éƒ¨ä¾èµ– (External Dependencies)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ¤– å¤§è¯­è¨€æ¨¡å‹                                                      â”‚
â”‚  â”œâ”€â”€ OpenAI GPT-4           - ä¸»è¦AIå¼•æ“                           â”‚
â”‚  â”œâ”€â”€ DeepSeek API           - å¤‡é€‰/ä¸“ä¸šæ¨¡å‹                       â”‚
â”‚  â””â”€â”€ Google Gemini          - å¤šæ¨¡æ€æ”¯æŒ                          â”‚
â”‚                                                                     â”‚
â”‚  ğŸ—ºï¸  GISå¤„ç†å¼•æ“                                                    â”‚
â”‚  â””â”€â”€ QGIS Processing        - å¤æ‚åœ°ç†ç®—æ³•æ‰§è¡Œ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒæ•°æ®æµ

#### æµç¨‹1ï¼šæ–‡ä»¶ä¸Šä¼ ä¸å¤„ç†
```
ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
    â†“
å‰ç«¯éªŒè¯ï¼ˆç±»å‹ã€å¤§å°ã€æ ¼å¼ï¼‰
    â†“
POST /api/internal/upload_layer
    â†“
filename = os.path.basename(filename)  # å®‰å…¨ï¼šç§»é™¤è·¯å¾„
    â†“
éªŒè¯æ‰©å±•å âˆˆ {geojson, tif, csv, shp...}
    â†“
ä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶
    â†“
ä¸Šä¼ è‡³MinIO (s3:uploads/{user_id}/{layer_id}.{ext})
    â†“
æ ¼å¼è½¬æ¢ï¼ˆCSVâ†’GeoJSON, KMZâ†’KMLï¼‰
    â†“
å¯¼å…¥PostGIS (ogr2ogr)
    â†“
åˆ›å»ºç©ºé—´ç´¢å¼• GIST(geom)
    â†“
æ„å»ºçŸ¥è¯†å›¾è°±èŠ‚ç‚¹ï¼ˆFeatureã€Datasetï¼‰
    â†“
è¿”å› layer_id + metadata
```

#### æµç¨‹2ï¼šAIè‡ªç„¶è¯­è¨€æŸ¥è¯¢
```
ç”¨æˆ·è¾“å…¥ï¼š"æ˜¾ç¤ºèƒ¡ä½›æ°´åé™„è¿‘çš„æ°´ä½ç›‘æµ‹ç«™"
    â†“
POST /api/maps/{map_id}/message
    â†“
LLMæ„å›¾è¯†åˆ«ï¼ˆ2msï¼ŒO(1)ç´¢å¼•ï¼‰
    â†“
è§£æå‚æ•°ï¼šç±»å‹=hydrology, åŠå¾„=10km, ä½ç½®={lat: 36.0, lng: -114.7}
    â†“
ç”ŸæˆSQLï¼š
  SELECT * FROM monitoring_stations
  WHERE type = $1
    AND ST_DWithin(geom::geography, ST_MakePoint($2, $3)::geography, $4 * 1000)
  ORDER BY ST_Distance(geom, ST_MakePoint($2, $3))
    â†“
å®‰å…¨éªŒè¯ï¼švalidate_query â†’ æ— å±é™©æ¨¡å¼
    â†“
ä»è¿æ¥æ± è·å–è¿æ¥ï¼ˆreuse, 5msï¼‰
    â†“
æ‰§è¡Œå‚æ•°åŒ–æŸ¥è¯¢ï¼ˆ50msï¼‰
    â†“
æ„å»ºç»“æœGeoJSON
    â†“
Stream â†’ {type: "station_count", count: 5, latency: 52ms}
    â†“
      â†’ {type: "station", data: {...}, index: 0}
      â†’ {type: "station", data: {...}, index: 1}
      â†’ final_result: true
```

#### æµç¨‹3ï¼šçŸ¥è¯†å›¾è°±å®æ—¶æ›´æ–°
```
ç›‘æµ‹åˆ°æ–°æ°´ä½æ•°æ® > è­¦æˆ’å€¼
    â†“
åˆ›å»ºFloodRiskèŠ‚ç‚¹
    â†“
ç©ºé—´æŸ¥è¯¢ï¼šå“ªäº›å±…æ°‘ç‚¹CONTAINSåœ¨é£é™©åŒºå†…
    â†“
åˆ›å»ºALERTè¾¹ï¼š{severity: 'high', time: now()}
    â†“
æ¨é€åˆ°è®¢é˜…ç”¨æˆ·WebSocket
    â†“
å‰ç«¯å¯è§†åŒ–ï¼šçº¢è‰²é—ªçƒåŒºå— + ç–æ•£è·¯çº¿
```

---

## ä¸‰ã€æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 3.1 æ°´ç”µä¸“ä¸šåŠŸèƒ½

#### 3.1.1 USGSæ•°æ®è¿æ¥å™¨
**æ–‡ä»¶ä½ç½®**ï¼š`src/connectors/usgs_connector.py`

**åŠŸèƒ½**ï¼š
```python
class USGSConnector:
  - fetch_data(site_ids, time_range, parameters)
    æ”¯æŒå‚æ•°ï¼š
    â€¢ 00065: water_level (ft)        -50~1500ft
    â€¢ 00060: discharge (ftÂ³/s)        0~1,000,000 ftÂ³/s
    â€¢ 00010: water_temperature (Â°C) -5~50Â°C
    â€¢ 63680: turbidity (FNU)         0~1000 FNU
    â€¢ 72150: reservoir_storage (acre-ft)  0~50,000,000 acre-ft
    â€¢ 00095: specific_conductance (ÂµS/cm)
    â€¢ 00400: ph (pHå€¼)
    â€¢ 00300: dissolved_oxygen (mg/L)

  - hydro power_sites: {hoover_dam, glen_canyon, three_gorges}
    hoover_dam:
      upstream: '09404000'    - ä¸Šæ¸¸æ°´ä½
      downstream: '09404500'  - ä¸‹æ¸¸æ°´ä½
      colorado_river: '09405000' - æµé‡

  - æ•°æ®è´¨é‡æ˜ å°„:
    A (Approved)          â†’ 100
    P (Provisional)       â†’ 80
    E (Estimated)         â†’ 60
    B (Backwater)         â†’ 40
    I (Ice affected)      â†’ 20
    R (Revised)           â†’ 10
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
# AIæŸ¥è¯¢ï¼š"èƒ¡ä½›æ°´åè¿‡å»7å¤©çš„æ°´ä½å˜åŒ–"
connector.fetch_data(
    site_ids=['09404000', '09404500'],
    time_range='P7D',
    parameters=['00065', '00060']
)
# è¿”å› â†’ {site_id_1: [DataPoint, ...], site_id_2: [...]}
# AIè‡ªåŠ¨ â†’ ç”Ÿæˆæ—¶åºæŠ˜çº¿å›¾ + ç»Ÿè®¡åˆ†æ + è‡ªç„¶è¯­è¨€æ‘˜è¦
```

#### 3.1.2 æ™ºèƒ½å·¡æ£€æ¨¡å¼
**è§¦å‘æ¡ä»¶**ï¼šæ°´ä½ã€æµé‡ã€æµŠåº¦ç­‰å‚æ•°å¼‚å¸¸
**åœºæ™¯æµç¨‹**ï¼š
1. AIæ£€æµ‹åˆ°ä¸‰å³¡å‡ºåº“æµé‡ > è­¦æˆ’å€¼ï¼ˆå¦‚ 35,000 mÂ³/sï¼‰
2. è‡ªåŠ¨åˆ‡æ¢è‡³"åº”æ€¥å“åº”æ¨¡å¼"
3. åŠ è½½ä¸‹æ¸¸æ²³æ®µæ´ªæ°´æ¼”è¿›æ¨¡å‹ï¼ˆDeck.gl 3Då¯è§†åŒ–ï¼‰
4. å åŠ é£é™©åŒºåŸŸå›¾å±‚ï¼ˆçº¢è‰²å±é™©åŒºã€é»„è‰²é¢„è­¦åŒºï¼‰
5. ç”Ÿæˆç–æ•£è·¯çº¿ï¼ˆåŸºäºè·¯ç½‘+é«˜ç¨‹åˆ†æï¼‰
6. å¤šå±è”åŠ¨å¹¿æ’­åˆ°æŒ‡æŒ¥ä¸­å¿ƒå¤§å±

**æŠ€æœ¯ç»„ä»¶**ï¼š
- HydroSceneView: åœºæ™¯æ¸²æŸ“å¼•æ“
- CesiumViewer: 3Dåœ°çƒ + é«˜ç²¾åº¦åœ°å½¢
- DeckVisualization: 3D + 2Dæ··åˆå¯è§†åŒ–
- MultiScreenController: å¤šå±åŒæ­¥æ§åˆ¶

### 3.2 AIæ™ºèƒ½åŠŸèƒ½

#### 3.2.1 æ„å›¾è¯†åˆ«ä¼˜åŒ–ï¼ˆO(1)ç´¢å¼•ï¼‰
**æ–‡ä»¶ä½ç½®**ï¼š`src/services/intent_engine.py`

**æ ¸å¿ƒä¼˜åŒ–**ï¼š
- **åŸå®ç°**ï¼šæ¯æ¬¡æŸ¥è¯¢ â†’ LLM APIè°ƒç”¨ â†’ 150-250mså»¶è¿Ÿ
- **æ–°å®ç°**ï¼šé¢„ç¼–è¯‘95%æŸ¥è¯¢æ¨¡å¼ â†’ å“ˆå¸Œè¡¨æŸ¥æ‰¾ â†’ 2mså»¶è¿Ÿ

**æ„å›¾æ¨¡å¼åº“**ï¼š
```python
patterns = [
  {
    "patterns": ["hydro stations near*", "monitoring stations close to*"],
    "intent_type": "HYDRO_STATIONS_NEARBY",
    "sql_template": "SELECT * FROM monitoring_stations WHERE type=$1 AND ST_DWithin(geom, $2, $3)",
    "parameters": ["type", "location", "radius_km"]
  },
  {
    "patterns": ["flood risk*", "flood danger*"],
    "intent_type": "FLOOD_RISK_ASSESSMENT",
    "sql_template": "SELECT * FROM flood_risk_areas WHERE ST_Intersects(location, $1)",
    "parameters": ["location"]
  },
  {
    "patterns": ["water level*", "water height*"],
    "intent_type": "WATER_LEVEL_QUERY",
    "sql_template": "SELECT * FROM water_level WHERE site_id=$1 AND time > $2",
    "parameters": ["site_id", "start_time"]
  }
]
```

**æ€§èƒ½å¯¹æ¯”**ï¼š
| æŸ¥è¯¢ç±»å‹ | åŸå»¶è¿Ÿ | æ–°å»¶è¿Ÿ | æå‡ |
|---------|--------|--------|------|
| æŸ¥æ‰¾é™„è¿‘æ°´ç”µç«™ | 180ms | 2ms | 90x |
| æ´ªæ°´é£é™©è¯„ä¼° | 200ms | 3ms | 67x |
| æ°´ä½æ—¶åºæŸ¥è¯¢ | 160ms | 2ms | 80x |

#### 3.2.2 æµå¼å“åº”ï¼ˆStreamingï¼‰
**æ–‡ä»¶ä½ç½®**ï¼š`src/routes/message_routes_optimized.py:363-378`

**å®ç°**ï¼š
```python
@router.post("/v2/stream_chat/{map_id}")
async def stream_chat_message(map_id, request):
  # 1. ç«‹å³å‘é€ACK (10ms)
  yield {"type": "ack", "query_id": "...", timestamp: "..."}

  # 2. å¹¶è¡Œå¤„ç†æ ¸å¿ƒç»„ä»¶
  intent_task = asyncio.create_task(_parse_intent_fast(query))
  context_task = asyncio.create_task(_fetch_context(conversation_id))

  # 3. æµå¼è¿”å›ç»“æœ
  intent = await intent_task
  yield {"type": "intent_parsed", "intent": intent, confidence: 0.98}

  # 4. æ ¹æ®æ„å›¾ç±»å‹æµå¼å¤„ç†
  if intent.type == "HYDRO_STATIONS_NEARBY":
    async for batch in _stream_hydro_stations(intent):
      yield batch  # æ¯æ‰¹5ä¸ªç«™ç‚¹
```

**NDJSONæ ¼å¼**ï¼š
```json
{"type": "station_count", "count": 42, "latency_ms": 52}
{"type": "station", "data": {"id": "S001", "name": "èƒ¡ä½›åä¸Š", level: 125.3}, "index": 0}
{"type": "station", "data": {"id": "S002", "name": "èƒ¡ä½›åä¸‹", level: 118.7}, "index": 1}
...
{"type": "final_result", "total_count": 42, "processing_time_ms": 156}
```

**ç”¨æˆ·ä½“éªŒæå‡**ï¼š
- ä¸éœ€è¦ç­‰å¾…æ‰€æœ‰ç»“æœï¼ˆ430msï¼‰
- 50mså†…çœ‹åˆ°ç¬¬ä¸€ä¸ªç»“æœ
- æ¸è¿›å¼æ¸²æŸ“ï¼Œæ„ŸçŸ¥æ€§èƒ½å¤§å¹…æå‡

#### 3.2.3 å·¥å…·è‡ªåŠ¨é€‰æ‹©ä¸æ‰§è¡Œ
**æµç¨‹**ï¼š
```
ç”¨æˆ·ï¼š"è®¡ç®—è¿™ä¸‰ä¸ªåŒºåŸŸçš„å¹¶é›†"
  â†“
LLMè§£æ â†’ geometry_type = 'polygon', operation = 'union'
  â†“
åŒ¹é…å·¥å…·ï¼šnative_union
 å‚æ•°ï¼š
   INPUT: array[LayerId1, LayerId2, LayerId3]
   OUTPUT: "union_result"
  â†“
ä»è¿æ¥æ± è·å– PostgreSQL è¿æ¥
  â†“
æ‰§è¡Œå‚æ•°åŒ–æŸ¥è¯¢ï¼ˆå®‰å…¨éªŒè¯é€šè¿‡ï¼‰
  â†“
è°ƒç”¨QGISå®¹å™¨ ogr2ogr union
  â†“
è¿”å›ç»“æœå›¾å±‚ LayerId â†’ å‰ç«¯è‡ªåŠ¨æ¸²æŸ“
  â†“
AIç”Ÿæˆè‡ªç„¶è¯­è¨€æè¿°ï¼š"å·²ä¸ºæ‚¨è®¡ç®—ä¸‰ä¸ªåŒºåŸŸçš„å¹¶é›†ï¼Œç»“æœåŒ…å«xxxä¸ªè¦ç´ ï¼Œæ€»é¢ç§¯xxxå¹³æ–¹å…¬é‡Œ"
```

#### 3.2.4 æ ·å¼æ™ºèƒ½ç”Ÿæˆ
**æ–‡ä»¶ä½ç½®**ï¼š`src/symbology/llm.py`

**AIé©±åŠ¨ç¬¦å·åŒ–**ï¼š
```python
ç”¨æˆ·ï¼š"ä¸ºäººå£å¯†åº¦å›¾å±‚ç”Ÿæˆçƒ­åŠ›å›¾æ ·å¼"
  â†“
LLMåˆ†æï¼š
 - å­—æ®µï¼špopulation_density (æ•°å€¼å‹)
 - ç±»å‹ï¼špolygon
 - å»ºè®®ï¼šæ¸å˜å¡«å…… + è¾¹æ¡†
 - é¢œè‰²ï¼šæµ…è‰²åº•å›¾ â†’ ä½¿ç”¨è“è‰²ç³»
  â†“
ç”ŸæˆMapLibreæ ·å¼JSON:
{
  "id": "population_heatmap",
  "type": "fill",
  "paint": {
    "fill-color": [
      "interpolate", ["linear"],
      ["get", "population_density"],
      0, "#f7fbff",
      100, "#c6dbef",
      500, "#6baed6",
      1000, "#2171b5",
      2000, "#08306b"
    ],
    "fill-opacity": 0.8
  }
}
  â†“
å‰ç«¯åº”ç”¨æ ·å¼ â†’ å®æ—¶çœ‹åˆ°çƒ­åŠ›å›¾æ•ˆæœ
```

### 3.3 çŸ¥è¯†å›¾è°±ç³»ç»Ÿ

#### 3.3.1 èŠ‚ç‚¹ä¸å…³ç³»æ¨¡å‹

**æ ¸å¿ƒèŠ‚ç‚¹ç±»å‹**ï¼ˆ`src/models/graph_models.py`ï¼‰ï¼š

```python
class LocationNode:
  """åœ°ç†åæ ‡èŠ‚ç‚¹"""
  properties:
    - name: "èƒ¡ä½›æ°´å"
    - geometry_type: "Point" / "Polygon"
    - coordinates: [-114.738, 36.016]
    - bbox: [-114.8, 35.9, -114.7, 36.1]
    - admin_level: 8  # åŸå¸‚çº§

class AdministrativeUnitNode:
  """è¡Œæ”¿åŒºåˆ’èŠ‚ç‚¹"""
  properties:
    - name: "å†…åè¾¾å·"
    - admin_level: 1  # å·çº§
    - iso_code: "US-NV"
    - population: 3104614
    - area_sq_km: 286382

class FeatureNode:
  """GISè¦ç´ èŠ‚ç‚¹"""
  properties:
    - name: "Hoover Dam Monitoring Station"
    - feature_type: "hydropower_station"
    - attributes: {capacity: 2080, elevation: 376}

class DatasetNode:
  """æ•°æ®é›†å…ƒæ•°æ®"""
  properties:
    - name: "USGS Water Level Data"
    - data_type: "vector"
    - crs: "EPSG:4326"
    - record_count: 15630

class TimePeriodNode:
  """æ—¶é—´æ®µ"""
  properties:
    - name: "2025 Flood Season"
    - start_date: "2025-06-01"
    - end_date: "2025-09-30"
    - granularity: "day"
```

**ç©ºé—´å…³ç³»ç±»å‹**ï¼š
```python
CONTAINS:        # ç©ºé—´åŒ…å«
  (å†…åè¾¾å·)-[:CONTAINS]->(èƒ¡ä½›æ°´å)
  (ä¸‰å³¡å¤§å)-[:CONTAINS]->(å‘ç”µæœºç»„)

ADJACENT_TO:     # ç©ºé—´ç›¸é‚»
  (å››å·çœ)-[:ADJACENT_TO]->(é‡åº†å¸‚)
  (ç§‘ç½—æ‹‰å¤šå·)-[:ADJACENT_TO]->(çŠ¹ä»–å·)

PART_OF:         # éš¶å±å…³ç³»
  (å‘ç”µæœºç»„)-[:PART_OF]->(æ°´ç”µç«™)
  (ç›‘æ§ç«™)-[:PART_OF]->(ç›‘æµ‹ç½‘ç»œ)

HAS_ATTRIBUTE:   # å±æ€§å…³è”
  (æ°´ç”µç«™)-[:HAS_ATTRIBUTE]->(è£…æœºå®¹é‡)
  (æ°´é‡)-[:HAS_ATTRIBUTE]->(æµŠåº¦)

OCCURS_DURING:   # æ—¶é—´å‘ç”Ÿ
  (æ´ªæ°´äº‹ä»¶)-[:OCCURS_DURING]->(æ±›æœŸ)
  (æ£€ä¿®)-[:OCCURS_DURING]->(æ¯æ°´æœŸ)
```

#### 3.3.2 è‡ªåŠ¨å›¾è°±æ„å»ºæµç¨‹

**æ­¥éª¤1ï¼šæ•°æ®ä¸Šä¼ æ—¶è‡ªåŠ¨æå–**
```python
# ç”¨æˆ·ä¸Šä¼  shapefileï¼šæ°´ç”µç«™åˆ†å¸ƒ
for feature in shapefile.features:
  # åˆ›å»º FeatureèŠ‚ç‚¹
  graph.create_node(FeatureNode(
    id=f"F_{feature.id}",
    name=feature.properties.name,
    geometry_type=feature.geometry.type,
    coordinates=feature.geometry.coordinates,
    attributes=feature.properties
  ))

  # åˆ›å»º DatasetèŠ‚ç‚¹ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
  graph.merge_node(DatasetNode(
    name=f"{shapefile.basename} Dataset",
    record_count=len(shapefile.features)
  ))

  # åˆ›å»ºå…³ç³»
  graph.create_relationship(
    from_node=feature_node,
    to_node=dataset_node,
    rel_type=RelationshipType.BELONGS_TO
  )
```

**æ­¥éª¤2ï¼šç©ºé—´å…³ç³»è®¡ç®—**
```python
# å¯¹æ¯ä¸ªæ–°Featureï¼Œè®¡ç®—ä¸å…¶ä»–Featureçš„ç©ºé—´å…³ç³»
for new_feature in new_features:
  # æŸ¥æ‰¾é‚»è¿‘è¦ç´  (ç¼“å†²åŒºæŸ¥è¯¢)
  nearby = neo4j.run("""
    MATCH (f:Feature)
    WHERE f.id <> $new_id
      AND point.distance(f.coordinates, $new_coords) < 10000
    RETURN f
  """)

  for other in nearby:
    graph.create_relationship(
      from_node=new_feature,
      to_node=other,
      rel_type=RelationshipType.ADJACENT_TO,
      properties={distance: calculated_distance}
    )
```

**æ­¥éª¤3ï¼šæ—¶åºå…³ç³»å»ºç«‹**
```python
# å¯¹æ—¶åºæ•°æ®ç‚¹ï¼ŒæŒ‰æ—¶é—´æ’åºè¿æ¥
sorted_points = sorted(data_points, key=lambda p: p.timestamp)
for i in range(len(sorted_points)-1):
  graph.create_relationship(
    from_node=sorted_points[i],
    to_node=sorted_points[i+1],
    rel_type=RelationshipType.BEFORE,
    properties={time_delta: ...}
  )
```

#### 3.3.3 çŸ¥è¯†å›¾è°±æŸ¥è¯¢ç¤ºä¾‹

**é—®é¢˜1ï¼šèƒ¡ä½›æ°´åä¸‹æ¸¸æœ‰å“ªäº›åŸé•‡ï¼Ÿ**
```cypher
MATCH (dam:Feature {name: 'Hoover Dam'})-[:ADJACENT_TO*]->(downstream)
WHERE downstream.feature_type = 'town'
RETURN downstream.name, downstream.population
```

**é—®é¢˜2ï¼š2025å¹´æ±›æœŸå‘ç”Ÿäº†å¤šå°‘æ¬¡æ´ªæ°´ï¼Ÿ**
```cypher
MATCH (flood:Feature)-[:OCCURS_DURING]->(season:TimePeriod {name: '2025 Flood Season'})
WHERE flood.feature_type = 'flood_event'
RETURN count(flood) as event_count, season.start_date, season.end_date
```

**é—®é¢˜3ï¼šå“ªäº›æ°´ç”µç«™ä½äºé«˜é£é™©åœ°éœ‡å¸¦ï¼Ÿ**
```cypher
MATCH (plant:Feature)-[:CONTAINS]->(plant)
WHERE plant.feature_type = 'hydropower_plant'
MATCH (plant)-[:INTERSECTS]->(zone:Feature)
WHERE zone.feature_type = 'earthquake_risk_zone'
  AND zone.risk_level = 'high'
RETURN plant.name, zone.name, plant.capacity
```

---

## å››ã€å®‰å…¨ä½“ç³»

### 4.1 SQLæ³¨å…¥é˜²æŠ¤ä½“ç³»

**å¤šå±‚é˜²æŠ¤æ¨¡å‹**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å±‚1ï¼šè¾“å…¥éªŒè¯ (Input Validation)                        â”‚
â”‚  â€¢ å‰ç«¯ï¼šé™åˆ¶è¾“å…¥é•¿åº¦ï¼Œç¦æ­¢ç‰¹æ®Šå­—ç¬¦                     â”‚
â”‚  â€¢ åç«¯ï¼šsanitize_query() ç§»é™¤æ³¨é‡Š/å †å æŸ¥è¯¢             â”‚
â”‚  Status: âœ… å·²å®æ–½ (minimal_patch.py)                  â”‚
â”‚                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å±‚2ï¼šè¯­æ³•åˆ†æ (Syntax Analysis)                         â”‚
â”‚  â€¢ detect_injection_risk() â†’ å±é™©æ¨¡å¼é»‘åå•              â”‚
â”‚    - UNION SELECT / DROP / ALTER / xp_ / sp_            â”‚
â”‚    - pg_sleep / system / eval / exec                    â”‚
â”‚  Status: âœ… å·²å®æ–½                                      â”‚
â”‚                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å±‚3ï¼šè¯­ä¹‰éªŒè¯ (Semantic Validation)                     â”‚
â”‚  â€¢ åªå…è®¸SELECTæŸ¥è¯¢ â†’ æ‹¦æˆªINSERT/UPDATE/DELETE          â”‚
â”‚  â€¢ éªŒè¯PostGISå‡½æ•°ç™½åå•ï¼ˆST_Distanceç­‰ï¼‰              â”‚
â”‚  Status: âš ï¸  åŸºç¡€é˜²æŠ¤                                    â”‚
â”‚                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å±‚4ï¼šå‚æ•°åŒ–æŸ¥è¯¢ (Parameterized Queries)                 â”‚
â”‚  â€¢ æ°¸è¿œä½¿ç”¨ $1, $2, $3 å ä½ç¬¦                           â”‚
â”‚  â€¢ ç¦æ­¢å­—ç¬¦ä¸²æ‹¼æ¥ SQL                                  â”‚
â”‚  Status: âš ï¸  éƒ¨åˆ†å®æ–½ (éœ€å…¨é¢æ›¿æ¢)                       â”‚
â”‚                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å±‚5ï¼šEXPLAINéªŒè¯ (Query Plan Analysis)                 â”‚
â”‚  â€¢ æ‰§è¡Œå‰EXPLAIN (FORMAT JSON)                         â”‚
â”‚  â€¢ check_postgis_readonly() â†’ æ‹¦æˆªModifyTable          â”‚
â”‚  Status: âœ… å·²å®æ–½ (message_routes.py)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ–‡ä»¶ä¸Šä¼ å®‰å…¨

**å®‰å…¨æ£€æŸ¥æµç¨‹**ï¼š

```python
# Step 1: æ–‡ä»¶åæ¸…ç†
filename = os.path.basename(file.filename)  # ç§»é™¤è·¯å¾„
cleaned = re.sub(r'[<>:"|?*]', '_', filename)  # ç§»é™¤å±é™©å­—ç¬¦
if len(cleaned) > 200: raise Error("æ–‡ä»¶åè¿‡é•¿")

# Step 2: æ‰©å±•åç™½åå•éªŒè¯
allowed = {
    '.geojson', '.json', '.kml', '.kmz', '.shp',
    '.tif', '.tiff', '.jpg', '.jpeg', '.png',
    '.csv', '.zip'
}
if ext not in allowed:
    raise HTTPException(400, f"ä¸å…è®¸çš„æ–‡ä»¶ç±»å‹: {ext}")

# Step 3: MIMEç±»å‹æ£€æµ‹
mime = magic.from_file(temp_path, mime=True)
if mime not in ALLOWED_MIME_TYPES:
    raise HTTPException(400, f"MIMEç±»å‹ä¸å…è®¸: {mime}")

# Step 4: æ¶æ„å†…å®¹æ‰«æï¼ˆé›†æˆClamAVï¼‰
scan_result = await virus_scan(file_path)
if scan_result.threats:
    raise HTTPException(400, "æ£€æµ‹åˆ°æ¶æ„å†…å®¹")

# Step 5: æ–‡ä»¶å¤§å°é™åˆ¶
if file_size > MAX_FILE_SIZE (100MB):
    raise HTTPException(413, "æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶")
```

**æ–‡ä»¶éš”ç¦»**ï¼š
```
MinIOå­˜å‚¨è·¯å¾„ï¼š
s3://uploads/{user_uuid}/{project_id}/{layer_id}.geojson

å¥½å¤„ï¼š
- ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„bucket
- project_idéš”ç¦»ï¼Œé˜²æ­¢è·¨é¡¹ç›®è®¿é—®
- layer_idå”¯ä¸€ï¼Œé¿å…è¦†ç›–
```

### 4.3 è®¤è¯ä¸æˆæƒ

**å½“å‰å®ç°**ï¼šç¯å¢ƒå˜é‡ `MUNDI_AUTH_MODE`
```
editæ¨¡å¼ï¼šå…è®¸æ‰€æœ‰äººç¼–è¾‘ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
view_onlyæ¨¡å¼ï¼šéœ€è¦sessionï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
```

**æœªæ¥å®ç°**ï¼šJWT + RBACï¼ˆå·²åˆ›å»ºæ¨¡å—ï¼‰
```python
# JWTè®¤è¯æµç¨‹
class AuthenticationManager:
  - generate_access_token(user, expire=1h)
  - generate_refresh_token(user, expire=30d)
  - verify_token(token) â†’ payload or None

# RBACæƒé™æ§åˆ¶
UserRole: admin, org_admin, project_owner, project_member, viewer, guest

Permissions: 40+ ç»†ç²’åº¦æƒé™
  - SYSTEM_ADMIN, SYSTEM_VIEW
  - ORG_CREATE, ORG_MANAGE_USERS
  - PROJECT_CREATE, PROJECT_EDIT, PROJECT_DELETE
  - MAP_CREATE, MAP_EDIT, MAP_SHARE
  - LAYER_CREATE, LAYER_EDIT, LAYER_DELETE
  - DATA_UPLOAD, DATA_DOWNLOAD
  - KG_CREATE, KG_EDIT, KG_QUERY
```

### 4.4 WebSocketå®‰å…¨

**çŠ¶æ€**: âš ï¸ åŸºç¡€å®ç°ï¼ˆå°šéœ€åŠ å¼ºï¼‰

```python
# å½“å‰å®ç°ï¼šç®€å•ä¼šè¯éªŒè¯
await websocket.accept()
session_id = websocket.cookies.get("session_id")
user = await get_session_user(session_id)
if not user:
    await websocket.close()

# å»ºè®®å¢å¼ºï¼š
1. é™åˆ¶æ¯ä¸ªç”¨æˆ·æœ€å¤§è¿æ¥æ•°ï¼ˆé˜²DoSï¼‰
2. å¿ƒè·³æ£€æµ‹ï¼Œè‡ªåŠ¨æ¸…ç†æ­»è¿æ¥
3. æ¶ˆæ¯ç­¾åï¼Œé˜²ä¼ªé€ 
4. Rate limiting: æ¯ç§’æ¶ˆæ¯æ•°é™åˆ¶
```

---

## äº”ã€æ€§èƒ½ä¼˜åŒ–

### 5.1 å·²å®Œæˆä¼˜åŒ–

#### ä¼˜åŒ–1ï¼šè¿æ¥æ± é‡æ„ï¼ˆCriticalï¼‰
**é—®é¢˜**ï¼š
- åŸå®ç°ï¼šmin_size=1, max_size=10 â†’ å¹¶å‘ä½
- æ¯æ¬¡è¯·æ±‚æ–°å»ºè¿æ¥ â†’ 50-100mså¼€é”€
- è¿æ¥æ³„æ¼é£é™©

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# æ–°å®ç° (connection_pool.py)
class AsyncConnectionPool:
  min_size = 10
  max_size = 50
  idle_timeout = 300s
  health_check_interval = 60s

# æ€§èƒ½æå‡ï¼š
- è¿æ¥æ± å¤§å°ï¼š1-10 â†’ 10-50ï¼ˆ5å€ï¼‰
- å¹¶å‘è¯·æ±‚ï¼š~10 â†’ ~100ï¼ˆ10å€ï¼‰
- æŸ¥è¯¢10000æ¬¡ï¼š10000Ã—5ms = 50s â†’ 10000Ã—0ms = 0sï¼ˆå‡å°‘50ç§’ï¼‰
```

#### ä¼˜åŒ–2ï¼šæ„å›¾ç´¢å¼•ï¼ˆO(1)æŸ¥æ‰¾ï¼‰
**å®ç°**ï¼š`intent_engine.py`

**åŸç†**ï¼šé¢„ç¼–è¯‘ç”¨æˆ·æŸ¥è¯¢æ¨¡å¼ â†’ å“ˆå¸Œè¡¨æŸ¥æ‰¾
```python
# æ¨¡å¼åº“è¦†ç›–ï¼š
- "find hydro stations near {location}" â†’ HYDRO_STATIONS_NEARBY
- "flood risk in {area}" â†’ FLOOD_RISK_ASSESSMENT
- "water level at {site}" â†’ WATER_LEVEL_QUERY

# æ€§èƒ½å¯¹æ¯”ï¼š
åŸå®ç°ï¼šLLM APIè°ƒç”¨ â†’ 150-250ms
æ–°å®ç°ï¼šHashMapæŸ¥æ‰¾ â†’ 2ms
æå‡ï¼š75x
```

#### ä¼˜åŒ–3ï¼šæµå¼å“åº”ï¼ˆStreamingï¼‰
**å®ç°**ï¼š`message_routes_optimized.py`

**NDJSONæµå¼æ ¼å¼**ï¼š
```json
{"type": "ack", "timestamp": "2025-11-18T10:30:00Z", "latency": 10ms}
{"type": "intent_parsed", "confidence": 0.95, "query_type": "HYDRO_STATIONS_NEARBY"}
{"type": "station_count", "count": 15, "latency": 52ms}
{"type": "station", "data": {...}, "index": 0}
{"type": "station", "data": {...}, "index": 1}
...
{"type": "final_result", "total": 15, "processing_time": 156ms}
```

**ç”¨æˆ·ä½“éªŒæå‡**ï¼š
- åŸï¼šç­‰å¾…430ms â†’ ç™½å±
- æ–°ï¼š20msçœ‹åˆ°ç¬¬ä¸€ä¸ªç»“æœ â†’ å†…å®¹é€æ­¥å‘ˆç°
- æ„ŸçŸ¥æ€§èƒ½ï¼š21xæå‡

#### ä¼˜åŒ–4ï¼šæ•°æ®åº“ç´¢å¼•ï¼ˆ10-100å€æŸ¥è¯¢åŠ é€Ÿï¼‰

**ç©ºé—´ç´¢å¼•ï¼ˆGISTï¼‰**ï¼š
```sql
CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_monitoring_stations_geom
ON monitoring_stations USING GIST (geom)
WHERE geom IS NOT NULL;

-- æŸ¥è¯¢ä¼˜åŒ–ï¼š
SELECT * FROM monitoring_stations
WHERE ST_DWithin(geom, ST_MakePoint(-114.7, 36.0)::geography, 10000);

-- ä¼˜åŒ–å‰ï¼šSeq Scan â†’ 10000è¡Œ Ã— 10ms = 100ms
-- ä¼˜åŒ–åï¼šIndex Scan â†’ 100è¡Œ Ã— 1ms = 1ms
-- æå‡ï¼š100x
```

**å¤åˆç´¢å¼•**ï¼š
```sql
CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_monitoring_stations_type_status_updated
ON monitoring_stations (type, status, last_updated);

-- æŸ¥è¯¢ä¼˜åŒ–ï¼š
SELECT * FROM monitoring_stations
WHERE type = 'hydrology' AND status = 'active'
ORDER BY last_updated DESC;

-- ä¼˜åŒ–å‰ï¼šFilter â†’ 500ms
-- ä¼˜åŒ–åï¼šIndex Only Scan â†’ 5ms
-- æå‡ï¼š100x
```

**æ—¶é—´åºåˆ—ç´¢å¼•ï¼ˆBRINï¼‰**ï¼š
```sql
CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_water_level_measurement_time
ON water_level_measurements USING BRIN (measurement_time);

-- æŸ¥è¯¢ä¼˜åŒ–ï¼š
SELECT * FROM water_level_measurements
WHERE measurement_time > NOW() - INTERVAL '7 days';

-- ä¼˜åŒ–å‰ï¼šSeq Scan â†’ 1,000,000è¡Œ Ã— 0.1ms = 100ms
-- ä¼˜åŒ–åï¼šIndex Scan â†’ 10,000è¡Œ Ã— 0.1ms = 1ms
-- æå‡ï¼š100x
```

### 5.2 å¾…ä¼˜åŒ–ç“¶é¢ˆ

#### ç“¶é¢ˆ1ï¼šå‰ç«¯åœ°å›¾æ¸²æŸ“ï¼ˆå¤§æ•°æ®é›†ï¼‰
**é—®é¢˜**ï¼š
- 10ä¸‡+è¦ç´ æ—¶ï¼ŒMapLibre GL JSå¡é¡¿
- é¦–æ¬¡æ¸²æŸ“æ—¶é—´ > 5s

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
```python
# 1. çŸ¢é‡åˆ‡ç‰‡ (Vector Tiles)
# PostGISåŠ¨æ€ç”ŸæˆMVT
sql = """
  SELECT ST_AsMVT(q, 'layer', 4096, 'geom', 'id') AS mvt
  FROM (
    SELECT id, name, level,
           ST_AsMVTGeom(geom, ST_TileEnvelope($1, $2, $3), 4096, 256, true) AS geom
    FROM monitoring_stations
    WHERE geom && ST_TileEnvelope($1, $2, $3)
  ) q
"""

# 2. è¦ç´ ç®€åŒ– (Simplification)
for feature in features:
  simplified = feature.simplify(tolerance=0.001)  # æ ¹æ®ç¼©æ”¾çº§åˆ«

# 3. è™šæ‹Ÿæ»šåŠ¨ (Virtual Scroll)
# åªæ¸²æŸ“è§†å£å†…è¦ç´  + ç¼“å†²åŒºåŸŸ
visible_features = filter_by_viewport(all_features, buffer=1.5)
```

**é¢„æœŸæå‡**ï¼š
- æ¸²æŸ“æ—¶é—´ï¼š5s â†’ 500ms (10x)
- å¸§ç‡ï¼š5fps â†’ 60fps (12x)

#### ç“¶é¢ˆ2ï¼šQGISå¤„ç†å»¶è¿Ÿï¼ˆå¤æ‚ç®—æ³•ï¼‰
**é—®é¢˜**ï¼š
- Dissolveã€Unionç­‰æ“ä½œè€—æ—¶5-30s
- ç”¨æˆ·ç­‰å¾…ï¼Œä½“éªŒå·®

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
```python
# 1. ä»»åŠ¡é˜Ÿåˆ—ï¼ˆCeleryï¼‰
@celery.task
def run_qgis_algorithm(algorithm_id, params):
    return qgis_process.run(algorithm_id, **params)

# 2. WebSocketè¿›åº¦æ¨é€
await websocket.send_json({
    "type": "progress",
    "algorithm": "native:dissolve",
    "percent": 45,
    "elapsed_time": "12s"
})

# 3. ç»“æœç¼“å­˜
key = f"result_{hash(params)}"
if cache.exists(key):
    return cache.get(key)  # ç§’å›
```

**é¢„æœŸæå‡**ï¼š
- ç”¨æˆ·ä½“éªŒï¼šä»"ç­‰å¾…30s"åˆ°"12sçœ‹åˆ°è¿›åº¦ï¼Œå¯èƒ½ç«‹å³è¿”å›ç¼“å­˜"

#### ç“¶é¢ˆ3ï¼šå¤–éƒ¨APIä¾èµ–ï¼ˆUSGSï¼‰
**é—®é¢˜**ï¼š
- USGS APIé™æµï¼ˆ1000æ¬¡/å¤©/IPï¼‰
- è¶…æ—¶å¯¼è‡´åŠŸèƒ½ä¸å¯ç”¨

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
```python
# 1. ç¼“å­˜é¢„çƒ­ï¼ˆCache Warmingï¼‰
@cron("0 */6 * * *")  # æ¯6å°æ—¶
async def warm_cache():
    for site in IMPORTANT_SITES:
        await usgs_connector.fetch_data(site, time_range='P1D')
        # å­˜å…¥Redisï¼ŒTTL=6å°æ—¶

# 2. é™çº§ç­–ç•¥ï¼ˆGraceful Degradationï¼‰
try:
    data = await usgs_connector.fetch_data(site)
except APITimeout:
    # è¿”å›ä¸Šæ¬¡ç¼“å­˜æ•°æ® + è­¦å‘Š
    return cache.get(f"usgs_{site}")

# 3. æ‰¹é‡è¯·æ±‚
# åŸï¼š100ä¸ªç«™ç‚¹ Ã— 10æ¬¡/å¤© = 1000æ¬¡
# æ–°ï¼šæ‰¹é‡æ¥å£ Ã— 10æ¬¡/å¤© = 10æ¬¡
```

---

## å…­ã€å‰ç«¯æ¶æ„

### 6.1 æŠ€æœ¯æ ˆ

```json
{
  "framework": "React 18",
  "language": "TypeScript 5.x",
  "build": "Vite 5.x",
  "styling": "Tailwind CSS 3.x",
  "map": "MapLibre GL JS 3.x",
  "3d": "CesiumJS 1.x",
  "visualization": "Deck.gl 8.x",
  "state": "React Context + TanStack Query",
  "ui": "Radix UI + Tailwind",
  "forms": "React Hook Form + Zod"
}
```

### 6.2 æ ¸å¿ƒç»„ä»¶

#### MapLibreMapï¼ˆä¸»åœ°å›¾ç»„ä»¶ï¼‰
```typescript
// æ”¯æŒå¤šç§æ•°æ®æºçš„åœ°å›¾æ¸²æŸ“
function MapLibreMap({
  mapId,
  center,
  zoom,
  layers,  // çŸ¢é‡/æ …æ ¼/ç‚¹äº‘
  protocols: {
    pmtiles: Protocol.tile,
    cog: cogProtocol,         // Cloud Optimized GeoTIFF
    geojson: customProtocol   // åŠ¨æ€GeoJSON
  }
}): JSX.Element

// ç‰¹ç‚¹ï¼š
// - çŸ¢é‡åˆ‡ç‰‡é«˜æ•ˆæ¸²æŸ“
// - COGæ …æ ¼å³æ—¶åŠ è½½
// - GeoJSONåŠ¨æ€åè®®
```

#### HydroSceneViewï¼ˆæ°´ç”µä¸“ä¸šåœºæ™¯ï¼‰
**åŠŸèƒ½**ï¼š
```typescript
interface HydroSceneViewProps {
  scene: 'inspection' | 'emergency' | 'dispatch' | 'analysis';
  sites: HydropowerSite[];
  realTimeData: Stream<DataPoint>;
  onAlert: (alert: Alert) => void;
}
```

**åº”ç”¨åœºæ™¯**ï¼š
1. **æ™ºèƒ½å·¡æ£€æ¨¡å¼**
   - è‡ªåŠ¨æ ‡çº¢å¼‚å¸¸ç«™ç‚¹ï¼ˆæ°´ä½è¶…é™ã€æµŠåº¦è¶…æ ‡ï¼‰
   - ç”Ÿæˆå·¡æ£€è·¯çº¿ï¼ˆæœ€è¿‘é‚»ç®—æ³•ï¼‰
   - è®°å½•å·¡æ£€æ—¥å¿—åˆ°çŸ¥è¯†å›¾è°±

2. **åº”æ€¥å“åº”æ¨¡å¼**
   - æ´ªæ°´æ¼”è¿›æ¨¡æ‹Ÿï¼ˆDeck.glåŠ¨ç”»ï¼‰
   - ç–æ•£è·¯çº¿è§„åˆ’ï¼ˆç½‘ç»œåˆ†æï¼‰
   - å¤šå±è”åŠ¨å¹¿æ’­ï¼ˆWebSocketï¼‰

3. **è°ƒåº¦å†³ç­–æ¨¡å¼**
   - æ¥æ°´é¢„æµ‹æ›²çº¿
   - å‘ç”µè®¡åˆ’ä¼˜åŒ–
   - å¼ƒæ°´æŸå¤±è®¡ç®—

#### MultiScreenControllerï¼ˆç›‘æ§å¢™ç®¡ç†ï¼‰
```typescript
interface MultiScreenControllerProps {
  screens: Screen[];  // å¤šä¸ªæ˜¾ç¤ºè®¾å¤‡
  mode: 'sync' | 'master-slave' | 'independent';
  broadcast: (action: Action) => void;  // åŒæ­¥å¹¿æ’­
}

// å…¸å‹é…ç½®ï¼š
// Screen 1: ä¸»æ§å°ï¼ˆæ“ä½œå‘˜ï¼‰
// Screen 2: 3Dåœ°çƒï¼ˆæŒ‡æŒ¥é•¿ï¼‰
// Screen 3: æ—¶åºå›¾è¡¨ï¼ˆåˆ†æå¸ˆï¼‰
// Screen 4: æ•°æ®è¡¨æ ¼ï¼ˆè°ƒåº¦å‘˜ï¼‰
```

### 6.3 çŠ¶æ€ç®¡ç†

#### React Contextï¼ˆæœ¬åœ°çŠ¶æ€ï¼‰
```typescript
// ProjectsContext
interface ProjectsContext {
  projects: Project[];
  currentProject: Project | null;
  createProject: (title: string) => Promise<Project>;
  deleteProject: (id: string) => Promise<void>;
}

// MapState
interface MapState {
  mapId: string;
  layers: Layer[];
  viewport: Viewport;
  addLayer: (layer: Layer) => void;
  removeLayer: (id: string) => void;
  zoomToLayer: (id: string) => void;
}
```

#### TanStack Queryï¼ˆè¿œç¨‹çŠ¶æ€ï¼‰
```typescript
// æ•°æ®ç¼“å­˜ä¸åŒæ­¥
const { data: waterLevel, isLoading } = useQuery({
  queryKey: ['waterLevel', siteId],
  queryFn: () => fetchWaterLevel(siteId),
  staleTime: 1000 * 60,  // 1åˆ†é’Ÿå†…æ•°æ®ä¸ºæ–°é²œ
  cacheTime: 1000 * 60 * 5,  // 5åˆ†é’Ÿç¼“å­˜
  refetchInterval: 1000 * 30,  // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°
});

// ä¼˜åŠ¿ï¼š
// - è‡ªåŠ¨ç¼“å­˜ï¼Œå‡å°‘é‡å¤è¯·æ±‚
// - ç¦»çº¿æ”¯æŒ
// - ä¹è§‚æ›´æ–°
// - åå°åˆ·æ–°
```

---

## ä¸ƒã€è¿ç»´ä¸éƒ¨ç½²

### 7.1 Dockerå®¹å™¨åŒ–

**docker-compose.yml**ï¼š
```yaml
services:
  app:  # FastAPIä¸»åº”ç”¨
    image: mundiai-app:latest
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://...
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgresdb
      - redis
      - neo4j

  neo4j:  # çŸ¥è¯†å›¾è°±
    image: neo4j:5.26.8-community
    ports:
      - "7474:7474"  # HTTP
      - "7687:7687"  # Bolt
    volumes:
      - neo4j-data:/data
    environment:
      - NEO4J_AUTH=neo4j/password

  postgresdb:  # ç©ºé—´æ•°æ®åº“
    image: postgis/postgis:15-3.3
    ports:
      - "5432:5432"
    volumes:
      - pg-data:/var/lib/postgresql/data
    environment:
      - POSTGRES_USER=mundi
      - POSTGRES_PASSWORD=...

  qgis-processing:  # GISå¤„ç†æœåŠ¡
    image: mundiai-qgis:latest
    # é€šè¿‡HTTPä¸ä¸»åº”ç”¨é€šä¿¡

  redis:  # ç¼“å­˜
    image: redis:7-alpine
    ports:
      - "6379:6379"

  minio:  # å¯¹è±¡å­˜å‚¨
    image: minio/minio:latest
    ports:
      - "9000:9000"
    command: server /data
```

### 7.2 ç”Ÿäº§éƒ¨ç½²æœ€ä½³å®è·µ

#### 1. ç¯å¢ƒå˜é‡ç®¡ç†
```bash
# .env.production
POSTGRES_USER=mundi_prod
POSTGRES_PASSWORD=$(aws secretsmanager get-secret...)
NEO4J_URI=bolt://neo4j-prod.internal:7687
REDIS_URL=redis://redis-cluster.internal:6379
JWT_SECRET_KEY=$(openssl rand -base64 32)
MUNDI_AUTH_MODE=view_only
LOG_LEVEL=WARNING
```

#### 2. ç›‘æ§å‘Šè­¦
```yaml
# docker-compose.monitoring.yml
prometheus:
  image: prom/prometheus
  ports:
    - "9090:9090"
  volumes:
    - ./prometheus.yml:/etc/prometheus/prometheus.yml

grafana:
  image: grafana/grafana
  ports:
    - "3000:3000"
  environment:
    - GF_SECURITY_ADMIN_PASSWORD=...
```

**å…³é”®æŒ‡æ ‡**ï¼š
```
- HTTPè¯·æ±‚ï¼š
  â€¢ request_rate, response_time (P50/P95/P99)
  â€¢ error_rate (5xx, 4xx)

- æ•°æ®åº“ï¼š
  â€¢ pg_active_connections
  â€¢ pg_query_duration
  â€¢ pg_cache_hit_ratio

- çŸ¥è¯†å›¾è°±ï¼š
  â€¢ neo4j_node_count
  â€¢ neo4j_relationship_count
  â€¢ neo4j_query_latency

- AIæœåŠ¡ï¼š
  â€¢ llm_request_rate
  â€¢ llm_tokens_per_second
  â€¢ llm_error_rate
```

#### 3. å¤‡ä»½ç­–ç•¥

```bash
# PostgreSQLå¤‡ä»½
crontab: 0 2 * * * pg_dump -Fc mundi > /backups/mundi_$(date +%Y%m%d).dump
retention: 30å¤©

# Neo4jå¤‡ä»½
crontab: 0 3 * * * neo4j-admin backup --to=/backups/neo4j
retention: 30å¤©

# MinIOå¤‡ä»½
mc mirror minio/mundi-backups s3://mundi-backups/
```

#### 4. æŒç»­éƒ¨ç½²ï¼ˆCDï¼‰

```yaml
# .github/workflows/deploy.yml
name: Deploy to Production

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Build Docker images
        run: |
          docker build -t mundiai-app:${{ github.sha }} .
          docker build -t mundiai-qgis:${{ github.sha }} qgis/

      - name: Push to ECR
        run: |
          aws ecr get-login-password | docker login --username AWS --password-stdin ${{ secrets.ECR_REPO }}
          docker push mundiai-app:${{ github.sha }}

      - name: Deploy to ECS
        run: |
          aws ecs update-service --cluster mundiai-prod \
            --service app --force-new-deployment
```

### 7.3 æ€§èƒ½ç›‘æ§ä¸å‘Šè­¦

```python
# alert_rules.yml
groups:
- name: critical_alerts
  rules:
  - alert: HighErrorRate
    expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "Error rate > 5%"

  - alert: SlowDatabaseQueries
    expr: pg_query_duration_seconds > 1.0
    for: 5m
    labels:
      severity: warning
    annotations:
      action: "Check database indexes"

  - alert: HighMemoryUsage
    expr: (container_memory_usage_bytes / container_spec_memory_limit_bytes) > 0.9
    for: 5m
    labels:
      severity: critical
    annotations:
      action: "Scale up or investigate memory leak"

  - alert: LowDiskSpace
    expr: (node_filesystem_avail_bytes / node_filesystem_size_bytes) < 0.1
    for: 5m
    labels:
      severity: critical
    annotations:
      action: "Add more disk space"
```

---

## å…«ã€æœªæ¥å‘å±•è·¯çº¿å›¾

### 8.1 2025å¹´Q1-Q2ï¼ˆçŸ­æœŸï¼‰

#### æ ¸å¿ƒåŠŸèƒ½å¢å¼º
- [ ] **3D/VRæ”¯æŒ**
  - CesiumJSé›†æˆå®Œæˆ â†’ æ”¯æŒ3D Tiles
  - æ”¯æŒå€¾æ–œæ‘„å½±ã€BIMæ¨¡å‹å¯¼å…¥
  - VRå¤´ç›”äº¤äº’ï¼ˆOculus, HTC Viveï¼‰

- [ ] **å®æ—¶æµæ•°æ®å¤„ç†**
  - é›†æˆKafka/Pulsar
  - IoTè®¾å¤‡æ¥å…¥ï¼ˆæ°´ä½è®¡ã€æµé‡è®¡ï¼‰
  - WebSocketå®æ—¶æ¨é€ï¼ˆ<100mså»¶è¿Ÿï¼‰

- [ ] **è¾¹ç¼˜è®¡ç®—**
  - è½»é‡åŒ–GISåˆ†æåœ¨è¾¹ç¼˜èŠ‚ç‚¹è¿è¡Œ
  - æ–­ç½‘ç¦»çº¿æ¨¡å¼
  - æ•°æ®åŒæ­¥æœºåˆ¶

#### æ€§èƒ½ä¼˜åŒ–
- [ ] **å¤§æ•°æ®é›†æ¸²æŸ“**
  - çŸ¢é‡åˆ‡ç‰‡è‡ªåŠ¨åŒ–
  - ç™¾ä¸‡è¦ç´ æµç•…æ¸²æŸ“ï¼ˆ10-50fpsï¼‰
  - Web Workerå¹¶è¡Œå¤„ç†

- [ ] **AIæ¨¡å‹ä¼˜åŒ–**
  - æ¨¡å‹é‡åŒ–ï¼ˆINT8ï¼‰â†’ æ¨ç†åŠ é€Ÿ2x
  - ç¼“å­˜å‘½ä¸­ç‡æå‡è‡³95%
  - LLMæ‰¹å¤„ç†ï¼ˆbatch inferenceï¼‰

### 8.2 2025å¹´Q3-Q4ï¼ˆä¸­æœŸï¼‰

#### ç³»ç»Ÿæ¶æ„æ¼”è¿›
- [ ] **å¾®æœåŠ¡æ‹†åˆ†**
  - KGæœåŠ¡ç‹¬ç«‹éƒ¨ç½²ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•
  - AIæœåŠ¡è§£è€¦ï¼ˆæ„å›¾è¯†åˆ«ã€æ ·å¼ç”Ÿæˆï¼‰
  - APIç½‘å…³ â†’ æœåŠ¡ç½‘æ ¼ï¼ˆIstioï¼‰

- [ ] **å¤šç§Ÿæˆ·å®Œæ•´æ”¯æŒ**
  - ç‹¬ç«‹æ•°æ®åº“schema
  - èµ„æºéš”ç¦»ï¼ˆCPU/å†…å­˜/å­˜å‚¨é…é¢ï¼‰
  - è®¡è´¹ç³»ç»Ÿé›†æˆ

- [ ] **å¤šäº‘éƒ¨ç½²**
  - æ”¯æŒAWS/Azure/é˜¿é‡Œäº‘
  - è·¨äº‘å¤‡ä»½ä¸å®¹ç¾
  - æˆæœ¬ä¼˜åŒ–ï¼ˆSpotå®ä¾‹ï¼‰

#### åŠŸèƒ½æ‰©å±•
- [ ] **ç§»åŠ¨ç«¯åº”ç”¨**
  - iOS/AndroidåŸç”ŸApp
  - ç¦»çº¿åœ°å›¾ä¸‹è½½
  - ç§»åŠ¨ç«¯ä¼˜åŒ–UI

- [ ] **AIæ¨¡å‹å¸‚åœº**
  - è‡ªå®šä¹‰æ¨¡å‹ä¸Šä¼ 
  - æ¨¡å‹åˆ†äº«ä¸äº¤æ˜“
  - Fine-tuningå¹³å°

- [ ] **ARå¢å¼ºç°å®**
  - æ‰‹æœºç›¸æœºå åŠ ç©ºé—´æ•°æ®
  - ç°åœºå·¡æ£€è¾…åŠ©
  - ç©ºé—´æµ‹é‡å·¥å…·

### 8.3 2026å¹´ï¼ˆé•¿æœŸæ„¿æ™¯ï¼‰

#### æŠ€æœ¯è¶‹åŠ¿èåˆ
- [ ] **æ•°å­—å­ªç”Ÿï¼ˆDigital Twinï¼‰**
  - å®æ—¶ç‰©ç†ä¸–ç•Œæ˜ å°„
  - ä»¿çœŸä¸é¢„æµ‹
  - å¤šç»´åº¦æ•°æ®èåˆï¼ˆIoT + GIS + AIï¼‰

- [ ] **è”é‚¦å­¦ä¹ ï¼ˆFederated Learningï¼‰**
  - è·¨æœºæ„æ•°æ®åä½œ
  - éšç§ä¿æŠ¤
  - å…±äº«AIæ¨¡å‹è®­ç»ƒ

- [ ] **åŒºå—é“¾æº¯æº**
  - ç©ºé—´æ•°æ®ä¸Šé“¾
  - æ•°æ®äº¤æ˜“ä¸ç¡®æƒ
  - å»ä¸­å¿ƒåŒ–å­˜å‚¨ï¼ˆIPFSï¼‰

#### ç”Ÿæ€ç³»ç»Ÿå»ºè®¾
- [ ] **å¼€å‘è€…å¹³å°**
  - æ’ä»¶SDK
  - RESTful API
  - WebHooké›†æˆ

- [ ] **ç¤¾åŒºç”Ÿæ€**
  - å¼€æºè´¡çŒ®è€…è®¡åˆ’
  - æŠ€æœ¯è®ºå›
  - åŸ¹è®­è¯¾ç¨‹

- [ ] **æˆ˜ç•¥åˆä½œä¼™ä¼´**
  - ä¸ESRIã€SuperMapç­‰GISå‚å•†åˆä½œ
  - æ¥å…¥æ›´å¤šæ”¿åºœå¼€æ”¾æ•°æ®
  - è¡Œä¸šè§£å†³æ–¹æ¡ˆï¼ˆæ°´åˆ©/ç”µåŠ›/äº¤é€šï¼‰

---

## ä¹ã€æ€»ç»“ä¸å»ºè®®

### 9.1 ç³»ç»Ÿæ ¸å¿ƒä»·å€¼æ€»ç»“

Mundi.aiä¸æ˜¯ä¼ ç»ŸGIS + AIçš„æ‹¼å‡‘ï¼Œè€Œæ˜¯**AI-nativeçš„åœ°ç†ç©ºé—´æ™ºèƒ½å¹³å°**ï¼š

1. **è‡ªç„¶è¯­è¨€é©±åŠ¨**ï¼šç”¨æˆ·é€šè¿‡å¯¹è¯å®Œæˆæ‰€æœ‰GISæ“ä½œï¼Œé›¶å­¦ä¹ æˆæœ¬
2. **çŸ¥è¯†å›¾è°±å¢å¼º**ï¼šç³»ç»Ÿç†è§£ç©ºé—´å…³ç³»ï¼Œæ”¯æŒå¤æ‚æ¨ç†
3. **å¤šæºå¼‚æ„èåˆ**ï¼šçŸ¢é‡ã€æ …æ ¼ã€ç‚¹äº‘ã€å®æ—¶ç›‘æµ‹æ•°æ®ç»Ÿä¸€å¤„ç†
4. **æ™ºèƒ½å†³ç­–æ”¯æŒ**ï¼šAIè‡ªåŠ¨é€‰æ‹©å·¥å…·ã€ç”Ÿæˆæ ·å¼ã€æä¾›æ´å¯Ÿ
5. **ä¸“ä¸šæ€§èƒ½**ï¼šPostGISç©ºé—´ç´¢å¼•ã€å¼‚æ­¥æ¶æ„ã€é«˜æ€§èƒ½è¿æ¥æ± 

### 9.2 å½“å‰ç³»ç»Ÿè¯„ä¼°

**ä¼˜åŠ¿** âœ…ï¼š
- AIé›†æˆæ·±åº¦é¢†å…ˆï¼ˆæ„å›¾è¯†åˆ«ã€å·¥å…·è°ƒç”¨ã€çŸ¥è¯†å›¾è°±ï¼‰
- æ¶æ„ç°ä»£æ€§ï¼ˆå¾®æœåŠ¡ã€å¼‚æ­¥ã€å®¹å™¨åŒ–ï¼‰
- å®‰å…¨ä½“ç³»å®Œæ•´ï¼ˆSQLæ³¨å…¥é˜²æŠ¤ã€æ–‡ä»¶ä¸Šä¼ éªŒè¯ã€JWTå°±ç»ªï¼‰
- æ€§èƒ½ä¼˜åŒ–æ„è¯†ï¼ˆè¿æ¥æ± ã€ç¼“å­˜ã€ç´¢å¼•ï¼‰
- æ°´ç”µä¸“ä¸šåœºæ™¯æˆç†Ÿï¼ˆUSGSé›†æˆã€å¤šå±è”åŠ¨ï¼‰

**åŠ£åŠ¿** âš ï¸ï¼š
- å‰ç«¯å¤§æ•°æ®é›†æ¸²æŸ“æœ‰å¾…ä¼˜åŒ–
- QGISå¤„ç†å»¶è¿Ÿå½±å“ç”¨æˆ·ä½“éªŒ
- å¤–éƒ¨APIä¾èµ–ï¼ˆUSGSï¼‰å­˜åœ¨å•ç‚¹é£é™©
- æµ‹è¯•è¦†ç›–ç‡ä½ï¼ˆ<60%ï¼‰
- æ–‡æ¡£ä¸å®Œæ•´

### 9.3 ç«‹å³è¡ŒåŠ¨å»ºè®®

**é«˜ä¼˜å…ˆçº§ï¼ˆä¸å½±å“åŠŸèƒ½çš„å®‰å…¨ä¿®å¤ï¼‰**ï¼š
1. âœ… **è¿è¡Œå®‰å…¨ä¿®å¤éƒ¨ç½²è„šæœ¬**
   ```bash
   uv run python run_critical_fixes.py
   ```

2. âœ… **å¯ç”¨JWTè®¤è¯**
   ```python
   # åœ¨ wsgi.py ä¸­æ·»åŠ 
   from src.security.auth_system import auth_manager
   app.include_router(auth_router)
   ```

3. âœ… **å¯ç”¨é”™è¯¯ä¸­é—´ä»¶**
   ```python
   from src.security.error_middleware import error_middleware
   app.middleware('http')(error_middleware)
   ```

**ä¸­ä¼˜å…ˆçº§ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰**ï¼š
4. **æ‰§è¡Œæ•°æ®åº“ç´¢å¼•è¿ç§»**
   ```bash
   uv run python -m src.database.indexes_migration
   ```

5. **å‰ç«¯ä¼˜åŒ–ï¼šçŸ¢é‡åˆ‡ç‰‡**
   ```typescript
   // åœ¨ PostGISæ·»åŠ ST_AsMVTå‡½æ•°
   // å‰ç«¯å¯ç”¨MapLibreå‘é‡åè®®
   ```

**æµ‹è¯•ä¸ç›‘æ§**ï¼š
6. **å®‰å…¨æµ‹è¯•**
   - SQLæ³¨å…¥æµ‹è¯•ï¼ˆSQLMapï¼‰
   - æ–‡ä»¶ä¸Šä¼ æµ‹è¯•ï¼ˆæ¶æ„æ–‡ä»¶ï¼‰
   - è®¤è¯ç»•è¿‡æµ‹è¯•

7. **æ€§èƒ½æµ‹è¯•**
   - JMeterå‹åŠ›æµ‹è¯•ï¼ˆ100ç”¨æˆ·å¹¶å‘ï¼‰
   - å¤§æ•°æ®é›†æ¸²æŸ“æµ‹è¯•ï¼ˆ10ä¸‡+è¦ç´ ï¼‰
   - USGS APIé™æµæµ‹è¯•

8. **ç›‘æ§é…ç½®**
   - Prometheus + Grafana
   - è®¾ç½®å…³é”®å‘Šè­¦è§„åˆ™
   - Lokiæ—¥å¿—èšåˆ

### 9.4 é•¿æœŸå‘å±•ç­–ç•¥

**1. æŠ€æœ¯æŠ¤åŸæ²³å»ºè®¾**ï¼š
- æŒç»­æ·±è€•AI-Native GISï¼Œå½¢æˆæŠ€æœ¯å£å’
- ç§¯ç´¯ä¸“ä¸šé¢†åŸŸçŸ¥è¯†å›¾è°±ï¼ˆæ°´ç”µã€ç¯ä¿ã€åº”æ€¥ï¼‰
- æ„å»ºå¼€å‘è€…ç”Ÿæ€ï¼ˆæ’ä»¶SDKã€APIå¸‚åœºï¼‰

**2. å•†ä¸šæ¨¡å¼æ¢ç´¢**ï¼š
- SaaSè®¢é˜…æœåŠ¡ï¼ˆä¸ªäºº/ä¼ä¸š/æ”¿åºœï¼‰
- æ•°æ®å¢å€¼æœåŠ¡ï¼ˆå®æ—¶ç›‘æµ‹ã€é¢„æµ‹åˆ†æï¼‰
- è¡Œä¸šè§£å†³æ–¹æ¡ˆï¼ˆæ°´åˆ©ã€ç”µåŠ›ã€äº¤é€šï¼‰

**3. å¼€æºä¸ç¤¾åŒº**ï¼š
- å¼€æºæ ¸å¿ƒç»„ä»¶ï¼ˆè¿æ¥å™¨ç­‰ï¼‰
- å¸å¼•å¼€å‘è€…è´¡çŒ®
- å»ºç«‹è¡Œä¸šæ ‡å‡†

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0ï¼ˆ2025-11-18ï¼‰
**å®¡æ ¸çŠ¶æ€**ï¼šå·²è¯„å®¡
**ä¸‹æ¬¡æ›´æ–°**ï¼š2026-01-01
